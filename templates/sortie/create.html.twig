{% extends 'base.html.twig' %}

{% block title %}{{ parent() }} | Créer une sortie{% endblock %}
{% block body %}
    <h1>Créer une sortie</h1>

    {{ form_errors(sortieForm) }}
    {{ form_start(sortieForm) }}
    {{ form_row(sortieForm.nom) }}
    {{ form_row(sortieForm.dateDebut) }}
    {{ form_row(sortieForm.dateCloture) }}
    {{ form_row(sortieForm.nbInscriptionsMax) }}
    {{ form_row(sortieForm.duree) }}
    {{ form_row(sortieForm.descriptionInfos) }}
    {{ form_row(sortieForm.siteOrganisateur) }}
    {{ form_row(sortieForm.ville, {
        'attr': {
            'data-ville-id': ""~sortieForm.ville.vars.value,
            'class': "change-lieux-per-ville",
        }
    }) }}
    {{ form_row(sortieForm.addLieu) }}
    {{ form_row(sortieForm.lieu) }}

    {{ form_row(sortieForm.creer) }}
    {{ form_end(sortieForm) }}

{% endblock %}
{% block javascripts %}
    <script src="https://code.jquery.com/jquery-3.6.3.min.js"
            integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>
    <script>
        $(document).on('change', '#create_sortie_ville', function () {

            var villeID = $(this).data("ville-id");

            $.ajax({
                url: '/create',
                type: "POST",
                data: 'villeID=' + villeID,
                dataType: 'JSON',
                success: function (data) {
                    var child = $(document).find('#create_sortie_lieu');
                    $.each(data, function (k, v) {
                        $(child).append('<option value="' + v[1] + '">' + v['TEST'] + '</option>');
                    })
                }
            });
        })
    </script>
{% endblock %}